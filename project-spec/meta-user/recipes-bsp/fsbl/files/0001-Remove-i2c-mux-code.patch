From f6ab93557aec9deb13e3f329b2a888da32d4eaf1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ionel=20B=C4=83di=C8=99or?= <ionel.badisor@digilent.ro>
Date: Mon, 22 Jun 2020 19:50:06 +0300
Subject: [PATCH 1/5] Remove i2c mux code

---
 lib/sw_apps/zynqmp_fsbl/src/xfsbl_ddr_init.c | 40 +-------------------
 1 file changed, 1 insertion(+), 39 deletions(-)

diff --git a/lib/sw_apps/zynqmp_fsbl/src/xfsbl_ddr_init.c b/lib/sw_apps/zynqmp_fsbl/src/xfsbl_ddr_init.c
index 4abca10ebf..ba00daf546 100644
--- a/lib/sw_apps/zynqmp_fsbl/src/xfsbl_ddr_init.c
+++ b/lib/sw_apps/zynqmp_fsbl/src/xfsbl_ddr_init.c
@@ -6641,45 +6641,7 @@ static u32 XFsbl_IicReadSpdEeprom(u8 *SpdData)
 		goto END;
 	}
 
-	/*
-	 * Configure I2C Mux to select DDR4 SODIMM Slave
-	 * 0x08U - Enable DDR4 SODIMM module
-	 */
-	TxArray = 0x08U;
-	XIicPs_MasterSendPolled(&IicInstance, &TxArray, 1U, XFSBL_MUX_ADDR);
-
-	/*
-	 * Wait until bus is idle to start another transfer.
-	 */
-	Status = XFsbl_PollTimeout(IicInstance.Config.BaseAddress +
-			XIICPS_SR_OFFSET, Regval, (Regval & XIICPS_SR_BA_MASK) == 0x0U,
-			XFSBL_IIC_BUS_TIMEOUT);
-	if (Status != XST_SUCCESS) {
-		UStatus = XFSBL_FAILURE;
-		goto END;
-	}
-
-	/*
-	 * Get Configuration to confirm the selection of the slave
-	 * device.
-	 */
-	Status = XIicPs_MasterRecvPolled(&IicInstance, SpdData, 1U,
-			XFSBL_MUX_ADDR);
-	if (Status != XST_SUCCESS) {
-		UStatus = XFSBL_FAILURE;
-		goto END;
-	}
-	/*
-	 * Wait until bus is idle to start another transfer.
-	 */
-	Status = XFsbl_PollTimeout(IicInstance.Config.BaseAddress +
-			XIICPS_SR_OFFSET, Regval, (Regval &
-				XIICPS_SR_BA_MASK) == 0x0U,
-			XFSBL_IIC_BUS_TIMEOUT);
-	if (Status != XST_SUCCESS) {
-		UStatus = XFSBL_FAILURE;
-		goto END;
-	}
+	//REMOVED I2C MUX
 
 	/*
 	 * Set SODIMM control address to enable access to lower
-- 
2.17.1

