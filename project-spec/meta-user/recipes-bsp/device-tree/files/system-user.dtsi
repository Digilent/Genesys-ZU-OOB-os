/include/ "system-conf.dtsi"
#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/media/xilinx-vip.h>
#include <dt-bindings/net/ti-dp83867.h>

/ {
	xclk_a: oscillator { /*12MHz oscillator on-board the Pcam 5C */
		compatible = "fixed-clock";
		#clock-cells = <1>;
		clock-frequency  = <12000000>;
		clock-output-names = "out";
	};
};

&sdhci1 {
	sd-uhs-sdr104;
	disable-wp;
};

/*
devicetree/bindings/net/macb.txt
devicetree/bindings/net/ti,dp83867.txt
devicetree/bindings/net/phy.txt
*/
&gem0 {
	phy-handle = <&phy0>;
	phy-mode = "rgmii-id";
	phy0: phy@15 {
		reg = <0x0F>;
		reset-gpios = <&gpio 43 GPIO_ACTIVE_LOW>; //changes to 44 in rev B
		reset-assert-us = <1>;
		reset_deassert-us = <200>;
		interrupt-parent = <&gpio>;
		interrupts = <38 IRQ_TYPE_LEVEL_LOW>;
		ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>; //overwrites strap config
		ti,tx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>; //overwrites strap config
		ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_4_B_NIB>;
		ti,clk-output-sel = <DP83867_CLK_O_SEL_REF_CLK>;
	};
};


/*
Adding support for the mux and expose all 8 segments.
RESET# pin of TCA9548 is inverted on-board. Mapped to
EMIO[0] which is line 78.
*/
&i2c0 {
	i2c-mux@70 {
		compatible = "nxp,pca9548";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x70>;
		reset-gpios = <&gpio 78 GPIO_ACTIVE_HIGH>;

		i2c@0 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <0>;

			pcam5c_a: sensor@3c {
				compatible = "ovti,ov5640";
				reg = <0x3c>;
				clocks = <&xclk_a 0>;
				clock-names = "xclk";
				reset-gpios = <&gpio 79 GPIO_ACTIVE_LOW>;
				port@0 {
					reg = <0>;
					sensor_out: endpoint {
						remote-endpoint = <&csiss_in>;
						clock-lanes = <0>;
						data-lanes = <1 2>;
					};
				};
			};
		};

		i2c@1 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <1>;
		};
		i2c@2 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <2>;
		};
		i2c@3 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <3>;
			pmu@43 { /* IRPS5401 - IC81 */
				#clock-cells = <0>;
				compatible = "infineon,irps5401";
				reg = <0x43>; /*PMBUS address*/
			};
			pmu@44 { /* IRPS5401 - IC83 */
				#clock-cells = <0>;
				compatible = "infineon,irps5401";
				reg = <0x44>; /*PMBUS address*/
			};
			pmu@45 { /* IRPS5401 - IC84 */
				#clock-cells = <0>;
				compatible = "infineon,irps5401";
				reg = <0x45>; /*PMBUS address*/
			};
		};
		i2c@4 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <4>;
			eeprom@51 { /*FMC VITA 57.1 FRU*/
				compatible = "atmel,24c02";
				reg = <0x51>;
				pagesize = <1>; /* varies between models, so use a safe value */
			};
		};
		i2c@5 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <5>;
			/* not sure if we should bind the eeprom driver to the SYZYGY DNA */
			eeprom@30 { /* SYZYGY DNA */
				compatible = "atmel,24c02";
				reg = <0x30>;
				read-only;
				address-width = <16>;
				size = <65536>; /*the whole 16-bit address range*/
			};
				};
		i2c@6 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <6>;
		};
		i2c@7 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <7>;
		};
	};
};

&qspi {
	flash@0 {
		compatible = "issi,is25lp256", "jedec,spi-nor";
		#address-cells = <1>;
		#size-cells = <1>;
		reg = <0x0>;
		spi-max-frequency = <150000000>; /*Zynq UltraScale+ maximum FQSPICLK1 according to ds925 */
	};
};

&mipi_csi2_rx_subsyst_0 {
	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;

			xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
			xlnx,video-width = <8>;
			xlnx,cfa-pattern = "rggb";

			csiss_out: endpoint {
				remote-endpoint = <&vcap_csi_in>;
			};
		};
		port@1 {
			reg = <1>;
			xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
			xlnx,video-width = <8>;
			xlnx,cfa-pattern = "rggb";
			csiss_in: endpoint {
				data-lanes = <1 2>;
				remote-endpoint = <&sensor_out>;
			};
		};
	};
};

&amba_pl {
	vcap_csi {
		compatible = "xlnx,video";
		dmas = <&axi_vdma_0 0>;
		dma-names = "port0"; /*this has to be port0 for some reason*/
		ports {
			#address-cells = <1>;
			#size-cells = <0>;
			port@0 {
				reg = <0>;
				direction = "input";
				vcap_csi_in: endpoint {
					remote-endpoint = <&csiss_out>;
				};
			};
		};
	};
};

&spi0 {
	gpioexp: gpio@1 {
		compatible = "microchip,mcp23s08";
		gpio-controller;
		#reset-cells = <1>;
		#gpio-cells = <2>;
		interrupt-parent = <&gpio>;
		interrupts = <25 8>;
		microchip,spi-present-mask = <0x01>;
		interrupt-controller;
		#interrupt-cells = <0x2>;
		reg = <1>; /*SS[1]*/
		spi-max-frequency = <10000000>;
	};
	/*wilc_spi@0 {
		compatible = "microchip,wilc1000", "microchip,wilc3000";
		spi-max-frequency = <48000000>;
		reg = <0>;
		irq-gpios = <&gpiom1 1 0>;
		reset-gpios = <&gpiom1 2 0>;
		chip_en-gpios = <&gpiom1 0 0>;
		status = "okay";
	};*/
};

/*&usb0 {
	status = "disabled";
};*/

&qspi {
	u-boot,dm-pre-reloc;
};

&flash0 {
	compatible = "is25lp256d", "jedec,spi-nor";
	spi-max-frequency = <150000000>; /*Zynq UltraScale+ maximum FQSPICLK1 according to ds925 */
};

&dwc3_0 {
	dr_mode = "host";
	snps,usb3_lpm_capable;
	phy-names = "usb3-phy";
	phys = <&lane1 4 0 3 100000000>;
	snps,dis_u2_susphy_quirk ;
	snps,dis_u3_susphy_quirk ;
	maximum-speed = "super-speed";
};

&dwc3_1 {
	snps,dis_u2_susphy_quirk ;
	snps,dis_u3_susphy_quirk ;
	//resets = <&gpiom1 5>;
	dr_mode = "host";
};

&ams_pl {
	xlnx,ext-channels {
		#address-cells = <1>;
		#size-cells = <0>;
		channel@0 {
			reg = <0>;
		};
		channel@5 {
			reg = <5>;
		};
		channel@6 {
			reg = <6>;
		};
		channel@7 {
			reg = <7>;
		};
		channel@8 {
			reg = <8>;
		};
	};
};
&axi_gpio_btn{
	gpio-line-names = "btnR", "btnL", "btnD", "btnC", "btnU";
};

&axi_gpio_led{
	gpio-line-names = "led1", "led2", "led3", "led4";
};

&axi_gpio_sw{
	gpio-line-names = "sw0", "sw1", "sw2", "sw3";
};

&pwm_rgb_led {
	compatible = "digilent,pwm-rgb-led";
};
